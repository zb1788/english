<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title>英语同步练</title>
    <link href="/public/Mobile//css/fonts.css" rel="stylesheet" type="text/css">
    <link href="/public/Mobile//css/style.css" rel="stylesheet">
    <script src="/public/Mobile//js/TouchSlide.1.1.js"></script>
	<script type="text/javascript" src="/public/Mobile//js/jquery.min.js"></script>  
	<script src="/public/Mobile//js/jquery.cookie.js" type="text/javascript"></script> 
</head>

<body>
<header>
    <div class="l fl"><a href="/mobile/textread/index"><i class="icon-chevron-left"></i><span>返回</span></a></div>
    <div class="c fl">读课文</div>
    <div class="r fl">
        <div id="dd" class="topMenu" tabindex="1">
            <span><i class="icon-more-horiz"></i></span>
            <ul class="dropdown">
                <!-- <li><a href="wordbook.html"><i class="icon-heart"></i>21</a></li>
                <li><a href="record.html"><i class="icon-list-alt"></i>5</a></li> -->
               <!--  <li><a href="/mobile/index/wordbook"><i class="icon-heart"></i><font class="wordcount"></font></a></li>
                <li><a href="/mobile/index/record"><i class="icon-list-alt"></i><font class="recordcount"></font></a></li> -->
                <li><a href="/mobile/index/index"><i class="icon-evil"></i>学习中心</a></li>
                <li><a href="/mobile/index/course"><i class="icon-pencil-square"></i><b>版本设置</b></a></li>
            </ul>
        </div>
    </div>
</header>
<section class="wordbook">
    <div class="wbBtn bLine" bid="0001040304030b"><p>Recycle1</p><p><font class="curindex">1</font>/2</p></div> 
</section>

<section class="read">
    <div id="iScroll" class="iScroll bWhite">
        <div class="hd" style="display:none;">
            <ul></ul>
        </div>
        <div class="bd" id="iScroll-bd">
            <div class="con">
            	<ul>
                    <div class="text">
                       <h3 class="active"></h3>
                            <p class="active"><span class="en" ></span></p>
                    </div>
                </ul>
            </div>
            <div class="con">
                    <ul>
                        <div class="text">
                           <h3 class="active"><a><i class="icon-volume-up"></i>Read aloud</a></h3>
                           <p class="active" bid="10220">
                                    <span class="en" mid="D7512F8E28CB512179AE0E8C54FEF861">
                                        Mike & John&nbsp;:&nbsp;Morning!                                    </span>
                                    <span class="ch" style="">
                                        Mike & John&nbsp;:&nbsp;早上好！                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="10A1190CA13D4DCA40C0B9A517E5D340">
                                        Chen Jie&nbsp;:&nbsp;Good morning. I'm Chen Jie. This is Sarah.                                    </span>
                                    <span class="ch" style="">
                                        Chen Jie&nbsp;:&nbsp;早上好。我是陈洁。这是萨拉。                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="80A753E9AF34D676A2C2CA77FA0118F3">
                                        Mike&nbsp;:&nbsp;I'm Zoom.                                    </span>
                                    <span class="ch" style="">
                                        Mike&nbsp;:&nbsp;我是Zoom.                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="1D3F1B27AA931798C42ACE3B6CC3412C">
                                        John&nbsp;:&nbsp;My name's Zip.                                    </span>
                                    <span class="ch" style="">
                                        John&nbsp;:&nbsp;我是Zip.                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="706DFAB1C36F4C04EE831928C911B261">
                                        Sarah&nbsp;:&nbsp;White hands?                                    </span>
                                    <span class="ch" style="">
                                        Sarah&nbsp;:&nbsp;白色的手？                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="A0F4FADE599D4091590A097D5D961532">
                                        Chen Jie&nbsp;:&nbsp;Brown arms?                                    </span>
                                    <span class="ch" style="">
                                        Chen Jie&nbsp;:&nbsp;棕色的胳膊                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="DAFD94F77EDE08C5F74DFC15B197D6EC">
                                        Zip&nbsp;:&nbsp;Hello!                                    </span>
                                    <span class="ch" style="">
                                        Zip&nbsp;:&nbsp;你好！                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="D0AFEF74F92B1424466E5598EB706447">
                                        Sarah&nbsp;:&nbsp;Look! Zoom and Zip!                                    </span>
                                    <span class="ch" style="">
                                        Sarah&nbsp;:&nbsp;看！Zoom和Zip!                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="0498D6A45D7D23DCAA11F2AA1FB51CDF">
                                        Mike&nbsp;:&nbsp;Bye!                                    </span>
                                    <span class="ch" style="">
                                        Mike&nbsp;:&nbsp;再见！                                    </span>
                                </p><p class="active" bid="10220">
                                    <span class="en" mid="F9FE2BBD9DD3C57F36BFF66317ABEA24">
                                        Sarah&nbsp;:&nbsp;Hey!                                    </span>
                                    <span class="ch" style="">
                                        Sarah&nbsp;:&nbsp;嘿！                                    </span>
                                </p>                        </div>
                    </ul>
                </div><div class="con">
                    <ul>
                        <div class="text">
                           <h3 class="active"><a><i class="icon-volume-up"></i>Sing a song</a></h3>
                           <p class="active" bid="10221">
                                    <span class="en" mid="386D17C1911636CCCCB36815A929CC86">
                                        &nbsp;How are you?                                    </span>
                                    <span class="ch" style="">
                                        &nbsp;你好吗？                                    </span>
                                </p><p class="active" bid="10221">
                                    <span class="en" mid="7AB45B434A9CA80B25212685B11BD78C">
                                        &nbsp;Hello, Mike. Hello, Chen Jie. Hello, hello! How are you? This is Mary. This is Willy. Nice to meet you. How are you? I'm fine. I'm fine. Thank you, thank you very much. I'm fine. I'm fine. Thank you, thank you very much.                                    </span>
                                    <span class="ch" style="">
                                        &nbsp;你好，迈克。你好，陈洁。你好，你好，你好吗？这是玛丽。这是威利。很高兴见到你。你好吗？我很好。我很好。谢谢你，非常谢谢你。我很好。我很好。谢谢你，非常谢谢你。                                    </span>
                                </p>                        </div>
                    </ul>
                </div> 
            <div class="con">
            	<ul>
                    <div class="text">
                       <h3 class="active"></h3>
                            <p class="active"><span class="en" >fasdfasdfasdfasd</span></p>
                    </div>
                </ul>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    TouchSlide( { slideCell:"#iScroll",
    titCell:".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
    autoPage:true, //自动分页
    defaultIndex:1,
    endFun:function(i){ //高度自适应
    	    mp.clear();
            $(".wbBtn font").text(i);
            $(".tips").hide();
            var bd = document.getElementById("iScroll-bd");
            bd.parentNode.style.minHeight = window.screen.availHeight+100+"px";
            document.getElementsByClassName("con")[i].getElementsByClassName("text")[0].style.minHeight=window.screen.availHeight+"px";
            bd.scrollTop="20px";
            if(i>0)bd.parentNode.style.transition="200ms";

             if((i-1)==2)
            {
                $(".wbBtn.bLine p:eq(1)").hide(); 
                $(".con:last span").text("正在加载下一单元......");
                var indexn="1";
                var unitcount="1";
            
                
                unitcount=parseInt(unitcount)-1;
                if(indexn!=unitcount)
                {
                   window.location.href="/mobile/textread/read/indexn/1/indexp/-1/model/tm/flag/0";
                }
                else
                {
                   $(".con:last span").text("您已经背诵到最有一个单元了，恭喜你已经学完本册书籍");
                   return false;
                }
            }
            
            if(i>0)
            {
              $('.text:eq('+i+') h3').click();
            }
            
            if((i)==2){$(".tips").show();}
            if((i)==0)
            {
            	$(".wbBtn.bLine p:eq(1)").hide();            	
          	    var indexp="-1";
            	if(indexp!='-1')
            	{
            	   $(".con:eq(0) span").text("正在加载上一单元......");
                   window.location.href="/mobile/textread/read/indexn/1/indexp/-1/model/tm/flag/1"; 
                }
            	else
            	{
               	   $(".con:eq(0) span").text("这里是第一单元，向左开始读课文");
               	   return false;
                }
            }

           
         }
    } );</script>
</section>

<section class="tips" style-"display:none;">
    <p class="txt">已经到最后一段课文了，向左滑动进入下一个单元。</p>
</section>
<div id="jplayer"></div> 
 

<script src="/public/Mobile//js/main.js"></script>
<script type="text/javascript" src="/public/Mobile//js/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="/public/Mobile//js/jquery.cookie.js"></script>

<script type="text/javascript"> 
$(".tips").hide();
mp = new Mplay();
var unitid="0001040304030b";
var textcount=$(".con").length;
mp.index=0;
mp.url = "en.czbanbantong.com:8081/yylmp3/mp3_text/";
var wordbcount=parseInt();
var recordcount=parseInt();
$(function() {
    $(".dropdown a:eq(0) .wordcount").text($.cookie("engm_wordbook_count"));
    $(".dropdown a:eq(1) .recordcount").text($.cookie("engm_record_count"));
    //$('.ch').hide(); 
    $('h3').removeClass('active');
    $('p').removeClass('active');
   // $(document).on('click', '.text h3', function() {
    $('.text h3').click(function(){
    	mp.clear();
        $(this).addClass("active");
        var pdom=$(this).nextAll('p');
        var ind=$(this).parents().prevAll().length-4;
        mp.index = pdom.index()-1;
        mp.repeat = 1;
        twordplay(".text:eq("+ind+")  p","span.en","active",1,1);
    });

    //$(document).on('click', '.text p', function() {
    $('.text p').click(function(){
    	mp.clear();
        mp.index = $(this).index()-1;
        mp.repeat = 1;
        var ind=$(this).parents().prevAll().length-4;
        twordplay(".text:eq("+ind+")  p","span.en","active",1,1);
        $(this).parent().find("h3").addClass("active");
    });
});

//获取mp3文件路径
function getmp3url(mp3name){
    //mp3name = mp3name.substr(0,mp3name.length-1);
    var mp3url = '';
    var quespeed = 1;
    //if(examstts_type == 1){           //系统生成
        if(quespeed == 0){
            mp3name = mp3name+'s';
        }
        else if(quespeed == 2){
            mp3name = mp3name+'q';
        }
    //}
    mp3url = mp.url+mp3name.substr(0,2)+'/'+mp3name+'.mp3';
    return mp3url;
}


function twordplay(pdom,cdom,cclass,repeat,timeoutnum)
{
    var allnum =  $(pdom).length; 
    var carindex = mp.index;
    //$(pdom).find("span.ch").hide();
    //$(pdom).removeClass(cclass);
    $(pdom + ":eq(" + carindex + ")").addClass(cclass);
    var $word = $(pdom + ":eq(" + carindex + ")").find(cdom);
    var mp3  = $word.attr("mid");
    $word.addClass(cclass);
    //$(pdom + ":eq(" + carindex + ")").find("span.ch").show();
    if (carindex < allnum) {

        mp.play(getmp3url(mp3));
        $("#jplayer").bind($.jPlayer.event.ended,function (event) {
            if (mp.repeat >= repeat) 
            {mp.index = mp.index + 1; mp.repeat = 1;}
            else
            {mp.repeat = mp.repeat + 1};                
            setTimeout(function(){twordplay(pdom,cdom,cclass,repeat,timeoutnum);}, timeoutnum * 1000); 
        });
    }
    else
    {
        mp.index = 0;
        $(".boxCon").show();
        $word.removeClass(cclass);
        var chapterid=$(pdom).attr("bid");
        $.get("/mobile/textread/study_text_record",{unitid:unitid,chapterid:chapterid},function(data){
            var recordcount=$(".dropdown a:eq(1) .recordcount").text();
            $(".dropdown a:eq(1) .recordcount").text(parseInt(recordcount)+parseInt(data.add));
            $.cookie("engm_record_count",parseInt($.cookie("engm_record_count"))+parseInt(data.add));
        });
      
    } 
}

function Mplay(){ 
   $("#jplayer").jPlayer({
        swfPath: "",
        wmode: "window",
        supplied: "mp3",
        preload: "none",
        volume: "1"
    });

    var oplay = new Object();  
    oplay.index = 0;
    oplay.url = "";
    oplay.repeat = 1;

    oplay.play = function(mp3){  
        oplay.clear();
        $("#jplayer").jPlayer("setMedia", {mp3:mp3}).jPlayer("play");
    };

    oplay.clear = function(){       
        $("#jplayer").jPlayer("stop");
        $("#jplayer").jPlayer("clearMedia");
        //$("#jplayer").data("SpeakMP3Value", "0");  
        $("#jplayer").unbind($.jPlayer.event.ended);
        $("#jplayer").unbind($.jPlayer.event.progress);
    };
    return oplay;  
}


function  BodyScroll(curpos){
  var container = $("html,body"); 
  var pos_y = $(curpos).offset().top-300;
  $("html,body").animate({scrollTop:pos_y},100);//1000是ms,也可以用slow代替
}
</script>
</body>
</html>