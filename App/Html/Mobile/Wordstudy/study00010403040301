<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
    <title>英语同步练</title>
    <link href="/public/Mobile//css/fonts.css" rel="stylesheet" type="text/css">
    <link href="/public/Mobile//css/style.css" rel="stylesheet">
    <meta name=”apple-mobile-web-app-status-bar-style” content=black” />
    <script src="/public/Mobile//js/TouchSlide.1.1.js"></script>
</head>

<body style="position:relative;">
    
<header class="fixed" style="position:fixed; top:0px;">
    <div class="l fl"><a href="/mobile/wordstudy/index"><i class="icon-chevron-left"></i><span>返回</span></a></div>
    <div class="c fl">学单词</div>
    <div class="r fl">
        <div id="dd" class="topMenu" tabindex="1">
            <span><i class="icon-more-horiz"></i></span>
            <ul class="dropdown">
                <!-- <li><a href="wordbook.html"><i class="icon-heart"></i>21</a></li>
                <li><a href="record.html"><i class="icon-list-alt"></i>5</a></li> -->
             <!--    <li><a href="/mobile/index/wordbook"><i class="icon-heart"></i><font class="wordcount"></font></a></li>
                <li><a href="/mobile/index/record"><i class="icon-list-alt"></i><font class="recordcount"></font></a></li> -->
                <li><a href="/mobile/index/index"><i class="icon-evil"></i>学习中心</a></li>
                <li><a href="/mobile/index/course"><i class="icon-pencil-square"></i><b>版本设置</b></a></li>
            </ul>
        </div>
    </div>
    <div class="wbBtn" bid="00010403040301"><p>Unit1 Part A</p><p style="display:none;"><font class="curindex">3</font>/4</p></div> 
    <div id="studymodel" class="model bLine"><span><a id="pm" class="cur" onclick="model_change(this);"><i class="icon-reorder"></i>列表模式</a></span><span><a id="tm" onclick="model_change(this);"><i class="icon-picture-in-picture"></i>图文模式</a></span>
    </div>   
</header>

<section class="wordbook" style="padding-top:158px; background-color:#fff;">
    <!--单词列表方式 -->
    <ul id="iStudy" class="wb bWhite iStudy">
        <li>
            <a class="twmp" wid="15491" mid="B59E57FD261506BCDDF108EADBF2F456.mp3" onclick="word_read(this);">
                <p class="icon"><i class="icon-volume-up"></i></p>
                <p>
                    <span>ruler</span>
                    <span>[ˈruːlə]</span>                    <span>n.直尺；统治者</span>
                </p>
            </a>
          <!--   <p class="iBtn">
                <a   class='aBtn fav cur' bid="1" onclick="collect(this);"><i class="icon-favorite"></i><font>取消</font></a>
             
            </p> -->
        </li><li>
            <a class="twmp" wid="15492" mid="3A2DE10DCE09877DA58BDC41944AAE71.mp3" onclick="word_read(this);">
                <p class="icon"><i class="icon-volume-up"></i></p>
                <p>
                    <span>pencil</span>
                    <span>[ˈpensl]</span>                    <span>n.铅笔，彩色铅笔；笔状物</span>
                </p>
            </a>
          <!--   <p class="iBtn">
                <a   class='aBtn fav cur' bid="1" onclick="collect(this);"><i class="icon-favorite"></i><font>取消</font></a>
             
            </p> -->
        </li><li>
            <a class="twmp" wid="15493" mid="28E2D86B4D8BBA3A37C7DD7557E96CD7.mp3" onclick="word_read(this);">
                <p class="icon"><i class="icon-volume-up"></i></p>
                <p>
                    <span>eraser</span>
                    <span>[ɪˈreɪzə]</span>                    <span>n.橡皮擦；橡皮；黑板擦</span>
                </p>
            </a>
          <!--   <p class="iBtn">
                <a   class='aBtn fav cur' bid="1" onclick="collect(this);"><i class="icon-favorite"></i><font>取消</font></a>
             
            </p> -->
        </li><li>
            <a class="twmp" wid="15494" mid="410F4FD12150C8A34287AA7D54231E99.mp3" onclick="word_read(this);">
                <p class="icon"><i class="icon-volume-up"></i></p>
                <p>
                    <span>crayon</span>
                    <span>[ˈkreɪən]</span>                    <span>n.彩色铅笔（或粉笔、蜡笔）</span>
                </p>
            </a>
          <!--   <p class="iBtn">
                <a   class='aBtn fav cur' bid="1" onclick="collect(this);"><i class="icon-favorite"></i><font>取消</font></a>
             
            </p> -->
        </li>        <div class="boxCon" style="display:none;"><a href="/mobile/wordrecite/recite/unitid/00010403040301" class="btn bGreen">背单词</a></div>
    </ul>
    
    <!--图文混合方式 -->

    <div id="iScroll" class="iScroll bWhite" style="display">
        <div class="hd" style="display:none;">
            <ul></ul>
        </div>
        <div class="bd" id="iScroll-bd">
        	<div class="con" style="">
            </div>
            <div class="con">
                <ul>
                    <div class="scrollCon">
                        <p><img _src="en.czbanbantong.com:8081/yylmp3/pic_word/e691542c142bc9ed4ca35264b5f89219.jpg" src="images/blank.png" /></p>
                        <p><span>ruler</span>
                        <span>[ˈruːlə]</span>                        <span>n.直尺；统治者</span>
                        <p><a class="aBtn bGreen" mid="B59E57FD261506BCDDF108EADBF2F456.mp3" wid="15491" onclick="aloud(this);">朗读</a></p>
                        <!-- <dl class="example">
                            <a class="active" mid="48D010DB3603C82EE1B6A61F2C323C04" onclick="read_exam(this);">
                                    <dt>1、ruler<i class="icon-volume-up"></i></dt>
                                    <dd>尺子</dd>
                                </a>                        </dl> -->                        
                    </div>
                </ul>
            </div><div class="con">
                <ul>
                    <div class="scrollCon">
                        <p><img _src="en.czbanbantong.com:8081/yylmp3/pic_word/b11ecc57f761f2cdd9cad49e4c95525e.jpg" src="images/blank.png" /></p>
                        <p><span>pencil</span>
                        <span>[ˈpensl]</span>                        <span>n.铅笔，彩色铅笔；笔状物</span>
                        <p><a class="aBtn bGreen" mid="3A2DE10DCE09877DA58BDC41944AAE71.mp3" wid="15492" onclick="aloud(this);">朗读</a></p>
                        <!-- <dl class="example">
                            <a class="active" mid="97E28BCBBD9F03A6C6237943549A55EC" onclick="read_exam(this);">
                                    <dt>1、pencil<i class="icon-volume-up"></i></dt>
                                    <dd>铅笔</dd>
                                </a>                        </dl> -->                        
                    </div>
                </ul>
            </div><div class="con">
                <ul>
                    <div class="scrollCon">
                        <p><img _src="en.czbanbantong.com:8081/yylmp3/pic_word/20150907142953569473.jpg" src="images/blank.png" /></p>
                        <p><span>eraser</span>
                        <span>[ɪˈreɪzə]</span>                        <span>n.橡皮擦；橡皮；黑板擦</span>
                        <p><a class="aBtn bGreen" mid="28E2D86B4D8BBA3A37C7DD7557E96CD7.mp3" wid="15493" onclick="aloud(this);">朗读</a></p>
                        <!-- <dl class="example">
                            <a class="active" mid="B04C187785199CB6610233DCA4561A8C" onclick="read_exam(this);">
                                    <dt>1、eraser<i class="icon-volume-up"></i></dt>
                                    <dd>橡皮</dd>
                                </a>                        </dl> -->                        
                    </div>
                </ul>
            </div><div class="con">
                <ul>
                    <div class="scrollCon">
                        <p><img _src="en.czbanbantong.com:8081/yylmp3/pic_word/20170713111305317776.jpg" src="images/blank.png" /></p>
                        <p><span>crayon</span>
                        <span>[ˈkreɪən]</span>                        <span>n.彩色铅笔（或粉笔、蜡笔）</span>
                        <p><a class="aBtn bGreen" mid="410F4FD12150C8A34287AA7D54231E99.mp3" wid="15494" onclick="aloud(this);">朗读</a></p>
                        <!-- <dl class="example">
                            <a class="active" mid="060C0B62035EFA372E1B16B236C9A244" onclick="read_exam(this);">
                                    <dt>1、crayon<i class="icon-volume-up"></i></dt>
                                    <dd>蜡笔</dd>
                                </a>                        </dl> -->                        
                    </div>
                </ul>
            </div>  
            <div class="con">
            </div>
        </div>
    </div> 
</section>

<section class="tips"  style="display:none;">
    <p class="txt">已经到最后一个单词了，向左滑动进入下一个单元。</p>
</section>
<section class="plr10" style="display:none;">
    <div class="boxCon">
       <!--  <p><a class="btn bYellow"><i class="icon-favorite"></i>&nbsp;收藏</a> --></p><p><a href="/mobile/wordrecite/index" class="btn bGreen">背单词</a></p>
	</div>
</section>
<div id="jplayer"></div> 
 
<script type="text/javascript" src="/public/Mobile//js/jquery.min.js"></script>  
<script type="text/javascript" src="/public/Mobile//js/xback.js"></script>  
<script src="/public/Mobile//js/main.js"></script>
<script type="text/javascript" src="/public/Mobile//js/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="/public/Mobile//js/hammer.min.js"></script>
<script type="text/javascript" src="/public/Mobile//js/jquery.cookie.js"></script>
 

<script type="text/javascript"> 
var unitid="00010403040301";
mp = new Mplay();
mp.index=0;
mp.url = "en.czbanbantong.com:8081/yylmp3/mp3_word/";
var model="pm";
$(function() {

    //设置
    if($.cookie("engm_wordbook_count")==null){
        $(".dropdown a:eq(0) .wordcount").text("0");    
    }else{
        $(".dropdown a:eq(0) .wordcount").text($.cookie("engm_wordbook_count"));
    }

    if($.cookie("engm_record_count")==null){
        $(".dropdown a:eq(1) .recordcount").text("0");
    }else{
        $(".dropdown a:eq(1) .recordcount").text($.cookie("engm_record_count"));
    }

    
    


    $(".tips").hide();
    $(".wbBtn p:eq(1)").hide();    
    $(".boxCon").hide();
    $("#iScroll").hide();
    $("#"+model).click();
    var hammertime = new Hammer(document.getElementById("iStudy"));
    //添加事件
    hammertime.on("swipeleft", function (e) {
    	var indexn="1";
    	var unitcount="1";
    	unitcount=parseInt(unitcount)-1;
    	if(indexn!=unitcount)
    	{
           window.location.href="/mobile/wordstudy/study/indexn/1/indexp/-1/model/pm/flag/0";
        }
    	else
    	{
       	   return false;
        }
    });
    hammertime.on("swiperight", function (e) {
    	var indexp="-1";
    	if(indexp!='-1')
    	{
           window.location.href="/mobile/wordstudy/study/indexn/1/indexp/-1/model/pm/flag/1"; 
        }
    	else
    	{
       	   return false;
        }
    });
    $(".btn.bYellow").click(function(){
       var wordid=$("bd ul:eq("+mp.index+")").find("a.aBtn.bGreen").attr("wid");
       $.get("/mobile/index/collect_word",{wordid:wordid,unitid:unitid},function(data){
            var wordcount=parseInt($(".dropdown a:eq(0) .wordcount").text());
            $(".dropdown a:eq(0) .wordcount").text(wordbcount+parseInt(data.add));
            $.cookie("engm_wordbook_count",parseInt($.cookie("engm_wordbook_count"))+parseInt(data.add));
        });
    });

    XBack.listen(function(){
      $('.l.fl').find('a').click();
    });
});




function twordplay(pdom,cdom,cclass,repeat,timeoutnum)
{

    var allnum =  $(pdom).length; 
    var carindex = mp.index;
    $(pdom + " " + cdom).removeClass(cclass);
    var $word = $(pdom + ":eq(" + carindex + ")").find(cdom);
    var mp3  = $word.attr("mid"); 
    var wordid  = $word.attr("wid");
    $word.addClass(cclass);
    if (carindex < allnum) {      
        mp.play(mp.url +  mp3);
        $("#jplayer").bind($.jPlayer.event.ended,function (event) {
            if (mp.repeat >= repeat) 
            {
                BodyScroll($word); 
                mp.index = mp.index + 1; 
                mp.repeat = 1;
                $.get("/mobile/wordstudy/study_word_record",{unitid:unitid,wordid:wordid},function(data){
                    var recordcount=parseInt($(".dropdown a:eq(1) .recordcount").text());
                    $(".dropdown a:eq(1) .recordcount").text(recordcount+parseInt(data.add));
                    $.cookie("engm_record_count",parseInt($.cookie("engm_record_count"))+parseInt(data.add),{path: '/'});
                });
            }
            else
            {mp.repeat = mp.repeat + 1};                
            setTimeout(function(){twordplay(pdom,cdom,cclass,repeat,timeoutnum);}, timeoutnum * 200);
        });
    }
    else
    {
        mp.index = 0;
        $(".tips").show();
        $(".boxCon").show();
        $(".plr10 .boxCon").hide();
        $word.removeClass(cclass);

    }   
}
function Mplay(){ 
   $("#jplayer").jPlayer({
        swfPath: "/public/Mobile//js/",
        wmode: "window",
        supplied: "mp3",
        preload: "none",
        volume: "1"
    });

    var oplay = new Object();  
    oplay.index = 0;
    oplay.url = "";
    oplay.repeat = 1;

    oplay.play = function(mp3){  
        oplay.clear();
        $("#jplayer").jPlayer("setMedia", {mp3:mp3}).jPlayer("play");
    };

    oplay.clear = function(){       
        $("#jplayer").jPlayer("stop");
        $("#jplayer").jPlayer("clearMedia");
        //$("#jplayer").data("SpeakMP3Value", "0");  
        $("#jplayer").unbind($.jPlayer.event.ended);
        $("#jplayer").unbind($.jPlayer.event.progress);
    };
    return oplay;  
}
function  BodyScroll(curpos){
var container = $("html,body"); 
var pos_y = $(curpos).offset().top-300;
$("html,body").animate({scrollTop:pos_y},100);//1000是ms,也可以用slow代替
}

//朗读单词
function aloud(obj){
    var mp3=$(obj).attr("mid");
     mp.play(mp.url +  mp3); 
}

//朗读例句
function read_exam(obj){
    var mp3=$(obj).attr("mid");
    mp.play("en.czbanbantong.com:8081/yylmp3/mp3_text/" +  mp3); 
}

//收藏取消功能实现
function collect(obj){
    if($(obj).attr("bid")=='0')
    {
        $(obj).attr("bid",'1');
        $(obj).removeClass(" aBtn fav");
        $(obj).addClass("aBtn fav cur");
        $(obj).find("font").text("取消");
        var wordid=$(obj).parent().parent().find("a.twmp").attr("wid");
        $.get("/mobile/wordstudy/collect_word",{wordid:wordid,unitid:unitid},function(data){
            var wordcount=parseInt($(".dropdown a:eq(0) .wordcount").text());
            $(".dropdown a:eq(0) .wordcount").text(wordbcount+parseInt(data.add));
            $.cookie("engm_wordbook_count",parseInt($.cookie("engm_wordbook_count"))+parseInt(data.add));

        });
   }
   else
   {
        $(obj).attr("bid",'0');
        $(obj).removeClass(" aBtn fav cur");
        $(obj).addClass("aBtn fav");
        $(obj).find("font").text("收藏");
        var wordid=$(obj).parent().parent().find("a.twmp").attr("wid");
        $.get("/mobile/index/delwordbook",{wordid:wordid},function(data){
            var wordcount=parseInt($(".dropdown a:eq(0) .wordcount").text());
            $(".dropdown a:eq(0) .wordcount").text(wordbcount-1);
            $.cookie("engm_wordbook_count",parseInt($.cookie("engm_wordbook_count"))-1);              
        });
    }
}

//单词按顺序读
function word_read(obj){
    mp.index=$(obj).parent().prevAll("li").length;
    mp.repeat = 1;
    twordplay(".iStudy li","a.twmp","active",2,1);
}

//读单词模式切换
function model_change(obj){
    $("#studymodel a").removeClass("cur");
    $(obj).addClass("cur");
    var id = $(obj).attr("id");  
    mp.clear();
    if (id=="tm") 
    {
    	
        $(".plr10 .boxCon").show();
        $("#iScroll").show();
        $(".wbBtn p:eq(1)").show(); 
        $("#iStudy").hide(); 
	    TouchSlide( { slideCell:"#iScroll",
	    titCell:".hd ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
	    autoPage:true, //自动分页
	    switchLoad:"_src",
	    defaultIndex:mp.index+1,
	    endFun:function(i){ //高度自适应
	            var bd = document.getElementById("iScroll-bd");
                try{
                   document.getElementsByClassName("con")[i].getElementsByClassName("scrollCon")[0].style.minHeight=window.screen.availHeight+"px"; 
               }catch(e){
                   console.log(e);
               }
	            
	            mp.index=i;
	            if(i>0)
	            {
                $(".aBtn.bGreen:eq("+(i-1)+")").click();
				var wordid=$(".aBtn.bGreen:eq("+(i-1)+")").attr("wid");
				$.get("/mobile/wordstudy/study_word_record",{unitid:unitid,wordid:wordid},function(data){
                    var recordcount=parseInt($(".dropdown a:eq(1) .recordcount").text());
                    $(".dropdown a:eq(1) .recordcount").text(recordcount+parseInt(data.add));
                    $.cookie("engm_record_count",parseInt($.cookie("engm_record_count"))+parseInt(data.add));
                });
                }
                $(".tips").hide();
                $(".wbBtn font").text(i);
	            //bd.parentNode.style.height = bd.children[i].children[0].offsetHeight+"px";
	            //if(i>0)bd.parentNode.style.transition="200ms";//添加动画效果
	            if((i)==0)
                {
                	$(".wbBtn.bLine p:eq(1)").hide(); 
                	var indexp="-1";
                	if(indexp!='-1')
                	{
                	   $(".con:eq(0)").text("正在加载上一单元......");
                       window.location.href="/mobile/wordstudy/study/indexn/1/indexp/-1/model/tm/flag/1"; 
                    }
                	else
                	{
                	   window.location.href="/mobile/wordstudy/study/indexn/1/indexp/-1/model/pm/flag/1/xflag/1"; 
                   	   return false;
                    }
                }
                if((i)==4){$(".tips").show();}
                if((i-1)==4)
                {
                	$(".wbBtn.bLine p:eq(1)").hide(); 
                	$(".con:last").text("正在加载下一单元......");
                	var indexn="1";
                	var unitcount="1";
                	unitcount=parseInt(unitcount)-1;
                	if(indexn!=unitcount)
                	{
                       window.location.href="/mobile/wordstudy/study/indexn/1/indexp/-1/model/tm/flag/0";
                    }
                	else
                	{
                	   window.location.href="/mobile/wordstudy/study/indexn/1/indexp/-1/model/pm/flag/0/xflag/1";
                   	   return false;
                    }
                }
	        }
	
	    } );       
    }
    else
    {
    	$(".twmp:eq("+mp.index+")").click();
        $(".plr10 .boxCon").show();
        $("#iScroll").hide();
        $(".wbBtn p:eq(1)").hide(); 
        $("#iStudy").show();
    }
}



</script>

</body>
</html>