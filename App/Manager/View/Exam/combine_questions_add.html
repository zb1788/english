<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>编辑模版</title>
<link href="__PUBLIC__/style/manage.css" rel="stylesheet" type="text/css" />
<link href="__PUBLIC__/js/uploadify/uploadify.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/uploadify/jquery.uploadify.min.js"></script>  
<script type="text/javascript"  src="__PUBLIC__/js/jquery.form.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/jquery.artDialog.js?skin=default"></script>
<script type="text/javascript" src="__PUBLIC__/js/iframeTools.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/common.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ue/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__PUBLIC__/ue/ueditor.all.min.js"> </script>  
<script type="text/javascript" src="__PUBLIC__/js/myueditor.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/exams.js"></script>
</head>
<body>
<div class="container">
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="box_border">
  <tr>
    <td class="p5">
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table">
    	<if condition="$type eq 1">
      <tr>
        <td height="34" class="td_right">输入框：</td>
        <td>
          <input name="ques" type="radio"  value='1' <if condition="$questype eq 1">checked='checked'</if>{$questype}/>选择题&nbsp;
          <input type="radio" name="ques"  value='3' <if condition="$questype eq 3">checked='checked'</if>/>判断题&nbsp;
          <input type="radio" name="ques"  value='4' <if condition="$questype eq 4">checked='checked'</if>/>排序题&nbsp;
        </td>
      </tr>
      <tr>
        <td class="td_right">适配年级：</td>
        <td>
            <input name="class" type="checkbox"  value='1' cid='1'/>小学&nbsp;
            <input name="class" type="checkbox"  value='2' cid='2'/>初中&nbsp;
            <input name="class" type="checkbox"  value='3' cid='3'/>高中&nbsp;        
        </td>
      </tr>
      <tr>
        <td class="td_right">&nbsp;</td>
        <td>
		    <volist name="grade" id="vo">
		    	<input type="checkbox" name="grade" value='{$vo.id}' bid='<if condition="($vo.id lt 7)">1<elseif condition="($vo.id lt 10)"/>2<else />3</if>'/>{$vo.name}&nbsp;
			</volist>  
        </td>
      </tr>
      <tr>
        <td class="td_right">难易程度：</td>
        <td>
            <input name="complexity" type="radio"  value='3' <if condition="$complexity eq 3">checked</if>/>较难&nbsp;
            <input type="radio" name="complexity"  value='2' <if condition="$complexity eq 2">checked</if>/>适中&nbsp;
            <input type="radio" name="complexity"  value='1' <if condition="$complexity eq 1">checked</if>/>容易&nbsp;
        </td>
      </tr>
      <tr>
        <td class="td_right">关键词：</td>
        <td>
        	<input type="text" class="input-text lh30" size="40" id="keyword" /><font style="color:gray;size:10px;">(关键词请以逗号隔开）</font>
                              来源：<input type="text"  class="input-text lh30" size="20" id="source" />
         </td>
      </tr>
	  </if>
      <tr>
        <td class="td_right">听力材料：</td>
        <td>&nbsp;&nbsp;<img class="listen_add" src="__PUBLIC__/images/jia.png" width="21" height="19" /></td>
      </tr>
      <tr>
      <td></td>
        <td>
        <table class="listen">
        <tr style="display:none;">
          <td><input type="text" class="input-text lh30" size="2"></td>
          <td><input type="text" class="input-text lh30" size="40"></td>
          <td>
         <select name="tvoice" class="select voiceid" bid='0'>
         	<option value="1">中男Liang</option>
            <option value="2">中女Hui</option>
            <option value="3" selected="selected">美女Kate</option>
            <option value="4">美女Salli</option>
			<option value="5">美男Joey</option>
            <option value="6">英女Bridget</option>
			<option value="7">英男Brian</option>
        </select>
          </td>
		  <td width="50" align="right">
          <img class="listen_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />
          </td>
          </tr>
          <if condition="$type neq 1">
		  	<volist name="listen" id="vo">
		  		<tr>
		          <td>
		          	<input type="text" class="input-text lh30" size="2" value="{$vo.sortid}">
				  </td>
		          <td>
		          	<input type="text" class="input-text lh30" size="40"  value="{$vo.vcontent}">
				  </td>
		          <td>
			         <select name="tvoice" class="select voiceid" bid="{$vo.id}">
			         	<option value="1" <if condition="$vo.vvoiceid eq 1">selected="selected"</if>>中男Liang</option>
			            <option value="2" <if condition="$vo.vvoiceid eq 2">selected="selected"</if>>中女Hui</option>
			            <option value="3" <if condition="$vo.vvoiceid eq 3">selected="selected"</if>>美女Kate</option>
			            <option value="4" <if condition="$vo.vvoiceid eq 4">selected="selected"</if>>美女Salli</option>
						<option value="5" <if condition="$vo.vvoiceid eq 5">selected="selected"</if>>美男Joey</option>
			            <option value="6" <if condition="$vo.vvoiceid eq 6">selected="selected"</if>>英女Bridget</option>
						<option value="7" <if condition="$vo.vvoiceid eq 7">selected="selected"</if>>英男Brian</option>
			        </select>
		          </td>
		          <td width="50" align="right">
		          <img class="listen_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />
		          </td>
               </tr>
		  	</volist>
		  <else />
			 <tr>
		          <td><input type="text" class="input-text lh30" size="2"></td>
		          <td>
		          	<input type="text" class="input-text lh30" size="40"  value="{$tncontent}">
				  </td>
		          <td>
			         <select name="tvoice" class="select voiceid" bid="0">
			         	<option value="1">中男Liang</option>
                        <option value="2">中女Hui</option>
			            <option value="3">美女Kate</option>
			            <option value="4">美女Salli</option>
						<option value="5">美男Joey</option>
			            <option value="6">英女Bridget</option>
						<option value="7">英男Brian</option>
			        </select>
		          </td>
		          <td width="50" align="right">
		          <img class="listen_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />
		          </td>
              </tr>
		  </if>
        </table>
        </td>
      </tr>
      <tr>
        <td class="td_right">题干：</td>
        <td>
          <p> 
            <script id="editor" type="text/plain" style="width:650px;height:80px;"><if condition="$type eq 2">{$tcontent}</if></script>
          </p>
          <p>
            <span class="red">备注：普通下划线______ 用  #下划线# ，填空用  ##答案[good]## 表示　</span>
          </p>
        </td>
      </tr>
      <tr>
        <td class="td_right">解析：</td>
        <td><textarea name="textarea" cols="30" rows="3" class="textarea" id="acontent"><if condition="$type eq 2">{$acontent}</if></textarea></td>
      </tr>
    </table>
    <table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table answer">
      <tr>
        <td class="td_right">小题列表：</td>
        <td>&nbsp;&nbsp;<img class="add" src="__PUBLIC__/images/jia.png" width="21" height="19" />&nbsp;&nbsp;</td>
      </tr>
      <tr>
        <td class="td_right">&nbsp;</td>
		<td style="display:none;">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table">
		            <tr>
		              <td width="50" align="right"><img class="del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
		              <td height="34" bgcolor="#CCCCCC">&nbsp;<strong>选择小题</strong></td>
		            </tr>
		            <tr>
		              <td align="right">题干：</td>
		              <td>&nbsp;
		                <textarea name="textarea2" cols="30" rows="3" class="textarea"></textarea></td>
		            </tr>
		            <tr>
		              <td align="right">类型：</td>
		              <td>
		              	<input name="choose" type="radio" value='1' checked="checked" class='choose'/> 文字
		                <input name="choose" type="radio" value='2' class='choose'/>图片
					  </td>
		            </tr>
		            <tr>
		              <td align="right">&nbsp;</td>
		              <td height="32">
		              	<input name="items" type="radio" value='A'/>A.
		                <input type="text" class="input-text lh30 question_answer" size="40" />
						<img width="60px" height="60px" style="display:none;" src=""><img>
		                <input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					  </td>
		            </tr>
		            <tr>
		              <td>&nbsp;</td>
		              <td height="32">
		              	<input name="items" type="radio" checked="checked" value='B'/>B.
		                <input type="text" class="input-text lh30 question_answer" size="40" />
						<img width="60px" height="60px" style="display:none;" src=""><img>
		                <input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					  </td>
		            </tr>
		            <tr>
		              <td>&nbsp;</td>
		              <td height="32">
		              	<input name="items" type="radio" value='C'/>C.
		                <input type="text" class="input-text lh30 question_answer" size="40" />
						<img width="60px" height="60px" style="display:none;" src=""><img>
		                <input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					  </td>
		            </tr>
	          </table>
		    </td>
	        <td>
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table">
					<tr>
					  <td width="50" align="right"><img class="del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
					  <td height="34" bgcolor="#CCCCCC">&nbsp;<strong>选择小题</strong></td>
					</tr>
					<tr>
					  <td align="right">题干：</td>
					  <td>&nbsp;
					    <textarea name="textarea2" cols="30" rows="3" class="textarea"></textarea></td>
					  </tr>
					<tr>
					  <td align="right">类型：</td>
					  <td>
					  	<input name="choose1" type="radio" value='1' checked="checked" class='choose'/> 文字
					    <input name="choose1" type="radio" value='2'  class='choose'/>图片 
					  </td>
					</tr>
					<tr>
					  <td align="right">&nbsp;</td>
					  <td height="32">
					  	<input name="status333" type="radio" value="A"/>A.
					    <input type="text" class="input-text lh30 question_answer" size="40" />
						<img class="img" src="" width="60px" height="60px" style="display:none;"><img>
					    <input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					  </td>
					</tr>
					<tr>
					  <td>&nbsp;</td>
					  <td height="32">
					  	<input name="status333" type="radio" value="B" checked="checked" />B.
					    <input type="text" class="input-text lh30 question_answer" size="40" />
						<img class="img" src="" width="60px" height="60px"  style="display:none;"><img>
					    <input type="button" value="上传"  class="ext_btn pic" style="display:none;" />
					  </td>
					</tr>
					<tr>
					  <td>&nbsp;</td>
					  <td height="32">
					  	<input name="status333" type="radio" value="C"/>C.
					    <input type="text" class="input-text lh30 question_answer" size="40" />
						<img class="img" src="" width="60px" height="60px" style="display:none;"><img>
					    <input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					  </td>
					</tr>
				</table>	
			</td>
			</tr>
	</table>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table answer">
		<tr>
			<td class="td_right">小题列表：</td>
			<td>&nbsp;&nbsp;<img class="add" src="__PUBLIC__/images/jia.png" width="21" height="19" />&nbsp;&nbsp;</td>
		</tr>
		<tr>
			<td class="td_right">&nbsp;</td>
			<td style="display:none;">
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table">
					<tr>
						<td width="50" align="right"><img class="del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
						<td height="34" bgcolor="#CCCCCC">&nbsp;<strong>判断小题</strong></td>
					</tr>
					<tr>
						<td align="right">题干：</td>
						<td>&nbsp;
						  <textarea name="textarea3" cols="30" rows="3" class="textarea"></textarea>
						</td>
					</tr>
					<tr>
						<td align="right">答案：</td>
						<td>
							<input name="status" type="radio" value='1'/>True
						    <input name="status" type="radio" value='0' checked="checked" />False 
						</td>
					</tr>
				</table>
			</td>
			<td>
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table">
					<tr>
						<td width="50" align="right"><img class="del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
						<td height="34" bgcolor="#CCCCCC">&nbsp;<strong>判断小题</strong></td>
					</tr>
					<tr>
						<td align="right">题干：</td>
						<td>&nbsp;
						  <textarea name="textarea2" cols="30" rows="3" class="textarea"></textarea>
						</td>
					</tr>
					<tr>
						<td align="right">答案：</td>
						<td>
						  <input name="status" type="radio" value='1'/> True
						  <input name="status" type="radio" value='0' checked="checked" />False 
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
	
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table answer">
		<tr>
			<td width="30" class="td_right">小题列表：</td>
			<td>&nbsp;&nbsp;<img class="add" src="__PUBLIC__/images/jia.png" width="21" height="19" />&nbsp;&nbsp;</td>
		</tr>
		<tr>
			<td class="td_right">&nbsp;</td>
			<td style="display:none;">
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table questions">
					<tr>
						<td width="50" align="right"><img  class="del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
						<td height="34" bgcolor="#CCCCCC"><strong>&nbsp;排序题</strong></td>
					</tr>
					<tr>
						<td align="right">类型：</td>
						<td>
							<input name="choose" type="radio" value='1' checked="checked" class='choose' />文字
							<input name="choose" type="radio" value='2'  class='choose'/>图片
						</td>
					</tr>
					<tr>
						<td align="right">&nbsp;</td>
						<td height="32"><img class="line_add" src="__PUBLIC__/images/jia.png" width="21" height="19" /></td>
					</tr>
					<tr style="display:none;" class="line_add_demo">
						<td align="right"><img class="line_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
						<td height="32">
							<input type="text" class="input-text lh30" value="" size="5" />
							<input type="text" class="input-text lh30 question_answer" size="40" />
							<img class="img" style="display:none;" width="60px" height="60px"></img>
							<input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
						</td>
				    </tr>
					<tr>
						<td align="right"><img class="line_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
						<td height="32">
							<input type="text" class="input-text lh30" value="" size="5" />
							<input type="text" class="input-text lh30 question_answer" size="40" />
							<img class="img" style="display:none;" width="60px" height="60px"></img>
							<input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
						</td>
					</tr>
					<tr>
						<td>&nbsp;&nbsp;</td>
						<td>
							<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table line_answer">
							  <tr>
							    <td align="right">答案：</td>
							    <td height="32">&nbsp;</td>
							  </tr>
							  <tr style="display:none;" class="line_add_demo1">
							  	<td width="50" align="right"></td>
							    <td height="32">
							      &nbsp;&nbsp;<input type="text" class="input-text lh30 line_answer1"  size="5""/>
								</td>
							  </tr>
							  <tr id="line1" bid="line">
							    <td width="50" align="right">1.</td>
							    <td height="32">
							      &nbsp;&nbsp;<input type="text" class="input-text lh30 line_answer1" size="5""/>
								</td>
							  </tr>
						   </table>
						</td>
					</tr>
				</table>
		    </td>
			<td>
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table questions">
				<tr>
					<td width="50" align="right"><img  class="del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
					<td height="34" bgcolor="#CCCCCC"><strong>&nbsp;排序题</strong></td>
				</tr>
				<tr>
					<td align="right">类型：</td>
					<td>
					<input name="choose" type="radio"  checked="checked" value="1" class='choose'/>文字
					<input name="choose" type="radio"  value="2" class='choose'/>图片
					</td>
				</tr>
				<tr>
					<td align="right">&nbsp;</td>
					<td height="32"><img class="line_add" src="__PUBLIC__/images/jia.png" width="21" height="19" /></td>
				</tr>
				<tr style="display:none;" class="line_add_demo">
					<td align="right"><img class="line_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
					<td height="32">
						<input type="text" class="input-text lh30" value="" size="5" />
						<input type="text" class="input-text lh30 question_answer" size="40" />
						<img class="img" style="display:none;" width="60px" height="60px"></img>
						<input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					</td>
				</tr>
				<tr>
					<td align="right"><img class="line_del" src="__PUBLIC__/images/jian.png" width="21" height="19" />&nbsp;&nbsp;</td>
					<td height="32">
						<input type="text" class="input-text lh30" value="" size="5" />
						<input type="text" class="input-text lh30 question_answer" size="40" />
						<img class="img" style="display:none;" width="60px" height="60px"></img>
						<input type="button" value="上传"  class="ext_btn pic" style="display:none;"/>
					</td>
				</tr>
				<tr>
					<td>&nbsp;&nbsp;</td>
					<td>
						<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table line_answer">
						  <tr>
						    <td align="right">答案：</td>
						    <td height="32">&nbsp;</td>
						  </tr>
						  <tr style="display:none;" class="line_add_demo1">
						  	<td width="50" align="right"></td>
						    <td height="32">
						      &nbsp;&nbsp;<input type="text" class="input-text lh30 line_answer1"  size="5""/>
							</td>
						  </tr>
						  <tr id="line1" bid="line1">
						    <td width="50" align="right">1.</td>
						    <td height="32">
						      &nbsp;&nbsp;<input type="text" class="input-text lh30 line_answer1" size="5""/>
							</td>
						  </tr>
						</table>
					</td>
				</tr>
				</table>
			</td>
			</tr>
		</table>
	  </td>
		</tr>
	</table>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="form_table">
		<tr>
			<td <if condition='$flag eq 1'>align="right"<else />align="center"</if>>
			  <input type="button" name="button"  id="save" class="btn btn82 btn_save2" value="保存" />&nbsp;
			</td>
			<if condition='$flag eq 1'>
				<td align="left">&nbsp;
				  <input type="button" name="button"  id="back" class="btn btn82 btn_save2" value="返回" />
				</td>
		    </if>
		</tr>
	</table>
	<div class="h10"></div>
	</td> 
   </tr> 
 </table>
</div>
<!--上传的div块-->
<div id="uploadfile" style="display:none;">
	<table>
	  <tr>
	    <td align="right"><font style="font-weight:10px;">图片：</font></td>
	    <td align="left">
	      <img src="" id="myimg" width="120" height="90" style="border:1px solid #CCC; padding:2px;" >
	    </td>
      </tr> 
	  <tr>
	    <td>&nbsp;</td>
	    <td>
	    	<div id="queue"></div>
			<input id="file_upload" name="file_upload" type="file" multiple="false"/>
		</td>
	  </tr>
	</table>
</div>

<script type="text/javascript"> 
var ue = UE.getEditor('editor');//ueditor插件
$(function(){ 
  $.ajaxSetup({async:false});
  //页面初始化,默认是选择题型
  $(".form_table.answer").hide();
  $(".form_table.answer:eq(0)").hide();
  if({$flag}==1){
  	$("input[name='ques']").attr("disabled",true);
  }
  //题型单击事件
  $("input[name='ques']").click(function(){
  	 var typeid=$(this).val()-1;
	 if(typeid>0){
	 	typeid=typeid-1;
	 }
	 $(".form_table.answer").hide();
	 $(".form_table.answer:eq("+typeid+")").show();
  });
  $("input[name='ques']:checked").click();
  //学段单击事件
  $("input[name='class']").click(function(){
    var phrase=$(this).val();
    if($(this).is(':checked'))
    {
       $("input[bid="+phrase+"]").attr('checked',true);
    }else{
       $("input[bid="+phrase+"]").attr('checked',false);
    }
  });
  //年级单击事件
  $("input[name='grade']").click(function(){
    var phrase=$(this).attr('bid');
    if(!$(this).is(':checked'))
    {
      $("input[cid="+phrase+"]").attr('checked',false);
    }else{
		//判断所在学段的年级是否全部选中
      if($("input[bid="+phrase+"]").length==$("input[bid="+phrase+"]:checked").length){
        $("input[cid="+phrase+"]").attr('checked',true);
      }
    }
  });
  //小题添加和删除
  $(".answer .add").live("click",function(){
 	var tr=$(this).parent().parent().parent().children("tr").eq(1).children("td").eq(1).children().clone();
	tr.find("input[name='status']").attr('name','status'+$('.form_table').length);
	tr.find("input[name='choose']").attr('name','choose'+$('.form_table').length);
	tr.find("input[name='items']").attr('name','items'+$('.form_table').length);
	$(this).parent().parent().parent().children("tr").eq(1).children("td").eq(2).append(tr);
  });
  $(".answer .del").live("click",function(){
  	$(this).parent().parent().parent().parent().remove();
  });
  //连线题的添加和删除
  $(".line_add").live("click",function(){
  	var td=$(this).parent().parent().parent().find(".line_add_demo").eq(0).clone().show();
	var len=$(this).parent().parent().parent().find(".line_del").length+2;
	$(this).parent().parent().parent().children("tr").eq(len).after(td);
	var td1=$(this).parent().parent().parent().find(".line_add_demo1").eq(0).clone().show();
	len=(len-2);
	td1.attr("bid","line"+len);
	td1.children("td").eq(0).text(len+".");
	$(this).parent().parent().parent().find(".line_answer1:last").parents("tr:eq(0)").parent().append(td1);
  });
  $(".line_del").live("click",function(){
  	var table=$(this).parent().parent().parent();
  	//var len=$(this).parent().parent().parent().parent().find(".line_del").length-1;
	var len=$(this).parent().parent().index()-3;
	table.find("tr[bid='line"+len+"']").remove();
	var sortid=0;
	$("tr[bid^='line']").each(function(){
		$(this).children("td").eq(0).text(sortid+".");
		$(this).attr("bid","line"+sortid);
		sortid+=1;
	});
  	$(this).parent().parent().remove();
  });
  //题的类型选择
  $(".choose").live("click",function(){
  	if($(this).val()=='1'){
		$(this).parent().parent().nextAll("tr").find(".question_answer").show();
		$(this).parent().parent().nextAll("tr").find("input[type='button']").hide();
	    $(this).parent().parent().nextAll("tr").find("img").hide();
	}else if($(this).val()=='2'){
		$(this).parent().parent().nextAll("tr").find("input[type='button']").show();
		$(this).parent().parent().nextAll("tr").find("img").show();
		$(this).parent().parent().nextAll("tr").find(".question_answer").hide();
	}
  });
  //听力材料的添加和删除
  $(".listen_add").click(function(){
 	var tr=$(".listen tr").eq(0).clone().show();
	tr.appendTo(".listen");
  });
  $(".listen_del").live("click",function(){
  	$(this).parent().parent().remove();
  });
  //返回按钮单击事件
  $("#back").click(function(){
  	if({$flag}==1){
	  location.href="../Exam/unitexam_questions_list?flag={$flag}&classid=2&paperid={$paperid}&questype={$questype}&examsid={$examsid}";
	}else{
	  location.href="../Exam/combine_questions_list?flag={$flag}&currentpage={$currentpage}&classid={$classid}&paperid={$paperid}&questype={$questype}&complexity={$complexity}";
	}
  });
  //保存按钮单击事件
  $("#save").click(function(){
  	 //短文答题的题干
	 if(0=={$id}){
		var questype=$("input[name='ques']:checked").val();//题型
		var complexity=$("input[name='complexity']:checked").val();//题的难度
		var keyword=$("#keyword").val();//关键字
		var source=$("#source").val();//试题来源
		var tcontent=ue.getContent();//题干
		var acontent=$("#acontent").val();//解析
		var itemtype=1;
		var grade =[];//定义一个年级数组
		$("input[name='grade']:checked").each(function(){
		grade.push($(this).val()); 
		});
		//小题情况添加短文答题内容
		var childcontent=[];//子小题的题干
		var childanswer=[];//定义答案的数组
		var childtype=[];//定义类型
		var childitemflag=[];//定义选项的标记
		var childitemcontent=[];//定义选项的内容
		//听力材料
		var vcontent=[];
		var itemids=[];
		$(".listen tr:gt(0)").each(function(){
			//听力的顺序
		var tingli=$(this).children("td");
		var obj={};
		obj.id=tingli.eq(2).find(".voiceid").attr("bid");
		obj.sortid=tingli.eq(0).find("input").val();
		obj.content=tingli.eq(1).find("input").val();
		obj.voiceid=tingli.eq(2).find(".voiceid").val();  
		vcontent.push(obj);  
		});
		
		if({$questype}=='1')
		{
			//选择小题的题干
			var parent=$(".answer:eq(0) .form_table:gt(0)");
		$(parent).each(function(){
		   var litcontent=$(this).children("tbody").children("tr:eq(1)").children("td:eq(1)").find("textarea:eq(0)").val();//小题的题干
		   childcontent.push(litcontent);
		   var liitemstype=$(this).children("tbody").children("tr:eq(2)").children("td:eq(1)").find("input[type='radio']:checked").val();//小题的选项类型
		   childtype.push(liitemstype);
		   var childitemconenttemp=[];//选项内容
		   var childitemflagtemp=[];//选项
		   var childanswertemp=[];//小题答案
		   var answer="";//答案
		   //childquestype.push($(this).children("tbody").children("tr:eq(1)").children("td:eq(1)").find("input:checked").val());//问题类型
		   $(this).children("tbody").children("tr:gt(2)").each(function(key,value){
		      //小题的选项
			  var td=$(this).children("td").eq(1);
			  var itemflag=td.find("input[type='radio']").val();//小题的标记
			  if (td.find("input[type='radio']").is(":checked")) {
			  	if(liitemstype=='1'){
					answer = td.find("input[type='radio']:checked").siblings("input[type='text']").eq(0).val();//小题的答案
				}else{
					answer = td.find("input[type='radio']:checked").siblings("input[type='button']").eq(0).attr("bid");//小题的答案
				}
			  	childanswertemp.push(answer);
			  }
			  childitemflagtemp.push(itemflag);
			  if(liitemstype=='1'){var itemcontent=td.find("input[type='text']").val();childitemconenttemp.push(itemcontent);}
			  else{var itemcontent=td.find("input[type='button']").attr("bid");childitemconenttemp.push(itemcontent);}
		   });
		   childitemcontent.push(childitemconenttemp.join("@"));
		   childitemflag.push(childitemflagtemp.join("@"));
		   childanswer.push(childanswertemp.join("@"));
		});
		}else if({$questype}=='3')
		{
			//判断小题的情况
		$(".answer:eq(1) .form_table:gt(0)").each(function(key,value){
			var childitemconenttemp=[];//选项内容
		    var childanswertemp=[];//小题答案
		    var litcontent=$(this).children("tbody").children("tr").eq(1).children("td").eq(1).find(".textarea").eq(0).val();//小题的题干
		    childitemconenttemp.push(litcontent);
		    childcontent.push(childitemconenttemp.join("@"));
		    var answer=$(this).children("tbody").children("tr").eq(2).children("td").eq(1).find("input[type='radio']:checked").val();
		    childanswertemp.push(answer);
		    childanswer.push(childanswertemp.join('@'));
		});
		}else if({$questype}=='4')
		{
			//连线小题的情况
		$(".answer:eq(2) .questions:gt(0)").each(function(key,value){
			   var itemtype=$(this).children("tbody").children("tr").eq(1).children("td").eq(1).find("input[type='radio']:checked").eq(0).val();//连线题类型
			   childtype.push(itemtype);
			   childcontent.push("");//连线题题干
			   var childitemconenttemp=[];//选项内容
		       var childitemflagtemp=[];//选项标志
			   if(itemtype=='1'){
			     $(this).find(".line_del:gt(0)").each(function(){
				   var itemflag=$(this).parents("tr").find("input[type='text']").eq(0).val();
				   childitemflagtemp.push(itemflag);
				   var itemcontent=$(this).parents("tr").find("input[type='text']").eq(1).val();
				   childitemconenttemp.push(itemcontent);
				 });
			   }
			   else if(itemtype=='2'){
			      $(this).find(".line_del:gt(0)").each(function(){
					   var itemflag=$(this).parents("tr").find("input[type='text']").eq(0).val();
					   childitemflagtemp.push(itemflag);
					   var itemcontent=$(this).parents("tr").find("input[type='button']").eq(0).attr("bid");
					   childitemconenttemp.push(itemcontent);
				 });
			   }
			   childitemcontent.push(childitemconenttemp.join('@'));
			   childitemflag.push(childitemflagtemp.join('@'));
			   //连线题答案
			   var answer=[];
			   $(this).find(".line_answer tr:gt(1)").each(function(){
				   answer.push($(this).find("input[type='text']").eq(0).val());
				 });
			   childanswer.push(answer.join("@"));
		   });
		}
		//判断必填项目
		if(grade.join(",")==''){art.dialog.tips("请勾选年级");return false;}
		//   if(vcontent==''){art.dialog.tips("请填写听力材料");return false;}
		//	 if(tcontent==''){art.dialog.tips("请填写题干");return false;}
		//	 if(acontent==''){art.dialog.tips("请填写解析");return false;}
		//	 if(answer==""){alert(questype);art.dialog.tips("请选择正确答案");return false;}
		$.post("../Exam/add_combine_questions",{ran:Math.random(),classid:'1',gradeid:grade.join(","),questype:questype,complexity:complexity,keyword:keyword,source:source,vcontent:JSON.stringify(vcontent),tcontent:tcontent,acontent:acontent,childcontent:childcontent.join(","),childitemflag:childitemflag.join(","),childitemcontent:childitemcontent.join(","),childanswer:childanswer.join(","),childtype:childtype.join(",")},function(){
			$(".btn_save2").attr("disabled","disabled");
			if({$flag}==1){
				location.href="../Exam/exam_questions_select?flag={$flag}&classid=2&paperid={$paperid}&questype={$questype}&id={$examsid}&gradeid={$gradeid}&termid={$termid}&versionid={$versionid}&unitid={$unitid}";
			}else{
				if({$type}==1){
					location.href="../Exam/combine_questions_add?flag={$flag}&currentpage={$currentpage}&classid={$classid}&paperid={$paperid}&questype={$questype}&complexity={$complexity}";
				}else{
					art.dialog.close();
				}
				
			}
		
		});
	 }
	 else
	 {
			var vcontent=[];
			$(".listen tr:gt(0)").each(function(){
				//听力的顺序
				var tingli=$(this).children("td");
				var obj={};
				obj.id=tingli.eq(2).find(".voiceid").attr("bid");
				obj.sortid=tingli.eq(0).find("input").val();
				obj.content=tingli.eq(1).find("input").val();
				obj.voiceid=tingli.eq(2).find(".voiceid").val();  
				vcontent.push(obj); 
			});
			var tcontent=ue.getContent();//题干
			var acontent=$("#acontent").val();//解析
			$.getJSON("../Exam/editCombineContentQuestions",{vcontent:JSON.stringify(vcontent),flag:{$flag},ran:Math.random(),id:{$id},tcontent:tcontent,acontent:acontent},function(){
				if({$flag}==1){
				location.href="../Exam/unitexam_questions_list?flag={$flag}&classid=2&paperid={$paperid}&questype={$questype}&id={$examsid}&gradeid={$gradeid}&termid={$termid}&versionid={$versionid}&unitid={$unitid}";
				}else{
					if({$type}==1){
						location.href="../Exam/combine_questions_add?flag={$flag}&currentpage={$currentpage}&classid={$classid}&paperid={$paperid}&questype={$questype}&complexity={$complexity}";
					}else{
						art.dialog.close();
					}
					
				}
            });
	 }
  });
  //上传按钮弹出框
  $(".ext_btn.pic").live("click",function(){
  	var ch=$(this);
	var img=$(this).parent().find("img:eq(0)");
	var path="";
	if($(this).attr("bid")!=undefined){path='../../uploads/'+$(this).attr("bid");}
	$("#uploadfile:eq(0)").find("img:eq(0)").attr("src",path);
  	var dialog = art.dialog({
	    content: $("#uploadfile")[0],
	    fixed: true,
	    ok: function(){
			//var iframe=this.iframe.currentWindow;
			var path=$("#myimg").attr("bid");
			$(ch).attr("bid",path);
			$(img).attr("src",'../../uploads/'+path);
		}
    });
  });
}); 

$(function(){
	$('#file_upload').uploadify({
    'height'    :30,
    'width'     :120,
    'buttonText': '上传图片',  //选择按钮显示的字符
    'multi'     : false,   //是否允许同时选择多个(false一次只允许选中一张图片)
    'method'    : 'post',
    'formData'  : {
      'folder'  : './uploads/exam/items',
      'fileext': 'png'
    },
    'swf'       : '__PUBLIC__/js/uploadify/uploadify.swf',
    'uploader'  : '../Upload/index',
    'fileTypeExts': '*.png;*.jpg', //允许的后缀
    'fileTypeDesc': 'Image Files', //允许的格式，详见文档
     'onUploadSuccess' : function(file, data, response) 
    {
      //上传成功后的触发事件  
      var obj=eval("("+data+")");
      $("#myimg").attr("src",'../../uploads/'+obj.msg.savepath + obj.msg.savename);
	  $("#myimg").attr("bid",obj.msg.savepath + obj.msg.savename);
    }
  });
	
});
</script>
</body>
</html>
