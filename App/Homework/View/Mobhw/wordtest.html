<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>英语同步练</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="wap-font-scale" content="no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="__PUBLIC__/css/mui.min.css">
		<link rel="stylesheet" href="__PUBLIC__/css/font-awesome.min.css">
		<link rel="stylesheet" href="__PUBLIC__/css/mui.edi.add.css">
		<style>
			html,
			body {
				background-color: #efeff4;
			}
			.mui-views,
			.mui-view,
			.mui-pages,
			.mui-page,
			.mui-page-content {
				position: absolute;
				left: 0;
				right: 0;
				top: 0;
				bottom: 0;
				width: 100%;
				height: 100%;
				background-color: #efeff4;
			}
			.mui-pages {
				top: 32px;
				height: auto;
			}
			.mui-scroll-wrapper,
			.mui-scroll {
				background-color: #efeff4;
			}
			.mui-page.mui-transitioning {
				-webkit-transition: -webkit-transform 300ms ease;
				transition: transform 300ms ease;
			}
			.mui-page-left {
				-webkit-transform: translate3d(0, 0, 0);
				transform: translate3d(0, 0, 0);
			}
			.mui-ios .mui-page-left {
				-webkit-transform: translate3d(-20%, 0, 0);
				transform: translate3d(-20%, 0, 0);
			}
			.mui-navbar {
				position: fixed;
				right: 0;
				left: 0;
				z-index: 10;
				height: 44px;
				background-color: #f7f7f8;
			}
			.mui-navbar .mui-bar {
				position: absolute;
				background: transparent;
				text-align: center;
			}
			.mui-android .mui-navbar-inner.mui-navbar-left {
				opacity: 0;
			}
			.mui-ios .mui-navbar-left .mui-left,
			.mui-ios .mui-navbar-left .mui-center,
			.mui-ios .mui-navbar-left .mui-right {
				opacity: 0;
			}
			.mui-navbar .mui-btn-nav {
				-webkit-transition: none;
				transition: none;
				-webkit-transition-duration: .0s;
				transition-duration: .0s;
			}
			.mui-navbar .mui-bar .mui-title {
				display: inline-block;
				width: auto;
			}
			.mui-page-shadow {
				position: absolute;
				right: 100%;
				top: 0;
				width: 16px;
				height: 100%;
				z-index: -1;
				content: '';
			}
			.mui-page-shadow {
				background: -webkit-linear-gradient(left, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
				background: linear-gradient(to right, rgba(0, 0, 0, 0) 0, rgba(0, 0, 0, 0) 10%, rgba(0, 0, 0, .01) 50%, rgba(0, 0, 0, .2) 100%);
			}
			.mui-navbar-inner.mui-transitioning,
			.mui-navbar-inner .mui-transitioning {
				-webkit-transition: opacity 300ms ease, -webkit-transform 300ms ease;
				transition: opacity 300ms ease, transform 300ms ease;
			}
			.mui-page {
				display: none;
			}
			.mui-pages .mui-page {
				display: block;
			}
			.mui-page .mui-table-view:first-child {
				margin-top: 15px;
			}
			.mui-table-view {
				margin-top: 20px;
			}
			
			.mui-table-view span.mui-pull-right {
				color: #999;
			}
			.mui-table-view-divider {
				background-color: #efeff4;
				font-size: 14px;
			}
			.mui-table-view-divider:before,
			.mui-table-view-divider:after {
				height: 0;
			}
			.mui-fullscreen {
				position: fixed;
				z-index: 20;
				background-color: #000;
			}
			.mui-ios .mui-navbar .mui-bar .mui-title {
				position: static;
			}
			#accountcontent a {
				margin: 5px;
				width: 40px;
				height: 40px;
				display: inline-block;
				text-align: center;
				background-color: #fff;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
			}
			.mui-content-padded a .mui-icon {
				margin-top: 12px;
			}
			.mui-spinner,
			.mui-spinner-white {
				margin-top: 12px
			}
			.active .mui-spinner-indicator {
				background: #007AFF;
			}
			
			#accountcontent a {
				color: #8F8F94;
			}
			#accountcontent a.active {
				color: #007aff;
			}
			#accountcontent a .mui-icon {
			   margin-top: 12px;
			}
			#accountcontent a .mui-icon {
				font-family: Muiicons;
				font-size: 20px;
				font-weight: 400;
				font-style: normal;
				line-height: 1;
				display: inline-block;
				text-decoration: none;
				-webkit-font-smoothing: antialiased;
			}
			.mui-icon-close:before {
				border-radius: 25px;	
			}
			/*设置标题样式字体*/
			div.title *{
			    font-size:1.2em;
			    font-family: times;
			    color: blueviolet;
			}			
			/*新的播放样式*/
			.play-pause {
			  width: 44px;
			  height:43px;
			  /*display: inline-block;
			  position: absolute;
			  left: 100px;
			  top: 7px;*/
			  margin:0 auto;
			  background-image: url("__PUBLIC__/images/play-dark.gif");
			  background-size:cover;
			  border-radius: 100px;
			  background-repeat: no-repeat;
			  cursor: pointer;
			}
			.play-pause.paused {
			  background-image: url("__PUBLIC__/images/pause-dark.gif");
			}
			.play-pause.pausing {
			  background-image: url("__PUBLIC__/images/play-to-pause-dark.gif");
			}
			.play-pause.playing {
			  background-image: url("__PUBLIC__/images/pause-to-play-dark.gif");
			}
			#loading{
				margin:0 auto;
                color:#000;
                border-width:4px;
                width: 44px;
                height: 44px;
                border-style: solid;
                border-color: #ccc #eee red blue;
                border-radius: 24px;
                -webkit-animation: loading  1s infinite linear;
            }
	        @-webkit-keyframes loading{
	                from{
	                	-webkit-transform:rotate(0deg);
	                }
	                to{
	                	-webkit-transform:rotate(360deg);
	                }
	        }
	        
	        /*小红点样式*/
	       .redpoint{
	       	  height:10px;
			  width:10px;
			  border-radius:16px;
			  font-size:0.1em;
			  color:#fff;
			  background:red;
	       }
	       
	       .head01 {
			  position: relative;
			  height: 40px;
			  font: 1.0em/40px "microsoft yahei";
			  width: 100%;
			  margin-top: 45px;
			  background: #EEEEEE;
			  color: #666;
			  overflow: hidden;
			}
			.head01 i {
			  position: absolute;
			  top: 14px;
			  left: 10px;
			  color: #159edc;
			}
			.head01 span {
			  display: block;
			  margin-left: 35px;
			  overflow: hidden;
			  color: #333;
			}
			.yeqian {
			  float: right;
			  color: #999;
			margin-right: 10px;
			}

			div.title p{
				color:black;
			}

			div.tkcontent p{
				color:black;
				background: white;
			}

			div.tkcontent table{
				nowrap:true;
				width:100%;
			}
			
			.flex-container {
				display: -webkit-box;
				display: -webkit-flex;
				display: flex;
				-webkit-flex-flow: row wrap;
				justify-content: space-between;
				text-align: center;
			}
			/*.mui-content-padded {
				padding: 10px;
			}*/
			.flex-container a {
				margin: 3px;
				width: 40px;
				height: 40px;
				display: inline-block;
				text-align: center;
				background-color: #fff;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
			}
			.flex-container a .mui-icon {
				margin-top: 7px;
			}
			/*.mui-spinner,
			.mui-spinner-white {
				margin-top: 12px
			}*/
			/*.active .mui-spinner-indicator {
				background: #007AFF;
			}
			.mui-content a {
				color: #8F8F94;
			}
			.mui-content a.active {
				color: #007aff;
			}*/
			.mui-backdrop {
			    position: fixed;
			    top: 0;
			    right: 0;
			    bottom: 0;
			    left: 0;
			    z-index: 998;
			    /*background:url("__PUBLIC__/images/loading.gif") no-repeat center center;*/
			    background-color: rgba(0,0,0,.3);
			}
					
		</style>
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/feedback.css" />
	</head>
	<body class="mui-fullscreen">
		<!--页面主结构开始-->
		<div id="app" class="mui-views">
			<div class="mui-view">
				<div class="mui-navbar">
				</div>
				<div class="mui-pages">
				</div>
			</div>
			<nav class="mui-bar mui-bar-tab" style="display:none;">
			    <button class="mui-tab-item" id="submithomework" style="width:100%;border: 1px solid #007aff;background-color: #007aff;color:white;font-size:1.2em;">
			       	 提交作业
			    </button>
			</nav>
		</div>
		<!--页面主结构结束-->
		<!--单页面开始-->
		<div id="setting" class="mui-page">
			<!--页面标题栏开始-->
			<div class="mui-navbar-inner mui-bar mui-bar-nav" style="background: #3cb0e0;">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-icon mui-icon-left-nav" style="font-size:1.1em;color:white;">返回</span>
				</button>
				<if condition="($wordalound neq '0'  or $textalound neq '0' or $examsquiz neq '0') and $issubmit eq '0'">
					<a class="mui-pull-right mui-right" href="#topPopover"  id="enhomework" style="position: fixed;top: 10px;right:6px;color:white;">
					 	 作业
					 	<if condition="($wordalound eq '0'  or $textalound eq '0' or $examsquiz eq '0') and $issubmit eq '0'">
							<span class="redpoint mui-icon" style="width:10px;height:10px;"> 
							</span>
						</if>
					</a>
				<else/>
					<a class="mui-pull-right mui-right"   id="enhomework" style="position: fixed;top: 10px;right:6px;color:white;">
					 	 作业
					</a>
				</if>
				<if condition="$issubmit eq '0' and $type eq '0'">
					<h1 class="mui-icon" id="timeshow" style="position:fixed;left:100px;top:-5px;">
						<font id="time" style="font-size:0.7em;color:white;">00:00</font>
					</h1>
				</if>
				<a class="mui-icon"  style="position:fixed;right:100px;top:0px;" id="summary" href="#account" >
					<i class="fa fa-calculator fa-1" style="font-size:20px;color:white;"></i>
				</a>
				
			</div>
			<!--页面标题栏结束-->
			<!--页面主内容区开始-->
			<div class="mui-page-content" style="background:white;">
				<div class="mui-scroll-wrapper" style="background:white;">
					<div class="mui-scroll" id="wordtest" style="background:white;height: 100%;">
						<div class="head01" style="margin-top: 10px;">
							<i class="fa fa-pencil-square-o fa-lg"></i>
							<span >
								<b class="yeqian" id="quesnum">
									<strong style="color:red;font-size:1.5em;" id="quesindex">{$index+1}</strong>/<font id="quesnumcount">{$quescount}</font>
								</b>单词测试
							</span>
						</div>
						<div class="content" id="content" style="background:white;margin-top:10px;height: 100%;">
						<!--内容填充页面-->
						</div>
					</div>
				</div>
			</div>
			<!--页面主内容区结束-->
		</div>
		<!--单页面结束-->
		<div id="account" class="mui-page">
			<div class="mui-navbar-inner mui-bar mui-bar-nav" style="background: #3cb0e0;">
				<button type="button" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
					<span class="mui-action-back mui-icon mui-icon-close mui-pull-left" style="padding-top:8px;"></span>
				</button>
				<h1 class="mui-center mui-title" style="color:white;">答题器</h1>
				<a class="mui-pull-right" href="#topPopover"  id="enhomework" style="position: fixed;top: 10px;right: 6px;color:white;">
				 	 作业
					<if condition="($wordalound eq '0' or $wordtest eq '0' or $textalound eq '0' or $examsquiz eq '0') and $issubmit eq '0'">
						<span class="redpoint mui-icon"> 
						</span>
					</if>
				</a>
				<!--<a class="mui-icon   mui-pull-right" id="summary" href="#account"></a>-->
			</div>
			<div class="mui-page-content">
				<div class="mui-scroll-wrapper" id="suwt" style="margin-bottom:53px;background-color: white;">
					<div class="mui-scroll" id="accountcontent" style="margin-top:20px;background: white;">
	                <!--答题器统计页面-->	
					</div>
					
				</div>
			</div>
		</div>
		<div id="jplayer"></div>
		<div id="topPopover" class="mui-popover" style="width:120px;min-height:120px;">
			<div>
				<ul class="mui-table-view">
					<!--<if condition="$wordalound neq '-1'">
						<li class="mui-table-view-cell enhome" location="question">
							<a href="javascript:void(0);">
								单词跟读
								<if condition="$wordalound eq '0'">
									<span class="redpoint mui-icon"> 
									</span>
								</if>
							</a>
						</li>
					</if>
					<if condition="$textalound neq '-1'">
						<li class="mui-table-view-cell enhome" location="http://www.baidu.com">
							<a href="javascript:void(0);">
								课文跟读
								<if condition="$textalound eq '0'">
									<span class="redpoint mui-icon"> 
									</span>
								</if>
							</a>
						</li>
					</if>-->
					<if condition="$examsquiz neq '-1'">
						<li class="mui-table-view-cell enhome" location="examsquiz?homeworkid={$homeworkid}&issubmit={$issubmit}&iserror={$iserror}&starttime={$starttime}&batchid={$batchid}&hwid={$hwid}&tms={$tms}&studentId={$studentid}&classId={$classid}">
							<a href="javascript:void(0);">
								听力训练
								<if condition="$examsquiz eq '0' and $issubmit eq '0'">
									<span class="redpoint mui-icon"> 
									</span>
								</if>
							</a>
						</li>
					</if>
				</ul>
			</div>
		</div>
	</body>
	<script>
	    var callbackURL="{$callbackURL}";
	    var hwid="{$hwid}";
	    var tms="{$tms}";
		var quescount=parseInt("{$quescount}");
		var studentid="{$studentid}";
		var classid="{$classid}";
		var homeworkid="{$homeworkid}";
		var summaryhtml="";
		var index="{$index}";
		var type="{$type}";
		var issubmit="{$issubmit}";
		var fheight=0;
		var pheight=0;
		var cheight=0;
		var starttime="{$starttime}";
		var word_mp3_url="http://en.czbanbantong.com/yylmp3/mp3_word/";
		//是不是只展示错题
		var iserror="{$iserror}";
		//定义音频避免同一页面频繁的数据请求
	    var listendata=[];
	</script>
	<script type="text/javascript" src="__PUBLIC__/js/mobile.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/jquery.jplayer.min.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/mp3.js"></script>
	<script src="__PUBLIC__/js/mui.min.js" type="text/javascript"></script>
	<script src="__PUBLIC__/js/mui.view.js" type="text/javascript"></script>
	<script type="text/javascript" src="__PUBLIC__/js/websql.js"></script>
	<script type="text/javascript" src="__PUBLIC__/js/learn.js"></script>
	<script>
		mui.init();
		mui.back=function(){
          //表示学生进去
          if(type=="0"&&issubmit=='0'){
            popTheController();
          }else if(type=="1"&&issubmit=='0'){
            //返回到教师的列表页面
            var url="{$callbackURL}";
            mui.openWindow(url);
          }else if(issubmit=='1'&&type=="0"){
          	mui.openWindow('finish?homeworkid={$homeworkid}&batchid={$batchid}&studentid={$studentid}&classid={$classid}');
          }else{
          	mui.openWindow('feedback?homeworkid={$homeworkid}&batchid={$batchid}&studentid={$studentid}&classid={$classid}');
          }
        }
		//学生做作业的时候才进行读秒的操作
		if(issubmit=='0'&&type=='0'){
			//进行时间的读秒
			var c=parseInt("{$time}"); 
			timedCount();
			function timedCount(){
				var min=0,secs=0;
				var value="";
			    min = parseInt(c / 60);// 分钟数  
			    if(min<10){
			    	value=value+"0"+min;
			    }else{
			    	value=value+min;
			    }
			    secs = c % 60;
			    if(secs<10){
			    	value=value+":0"+secs;
			    }else{
			    	value=value+":"+secs;
			    }
			    document.getElementById('time').innerHTML =value;
			    c=c+1  ;
			}
			setInterval("timedCount()",1000);
		}
		//页面初始化进行加载
		getWordTestRespose(studentid,classid,homeworkid,index);
		try{
			websqlOpenDB();
			websqlCreatTable("wordtest");
			websqlDeleteAllDataFromTable("wordtest");
		}catch(e){
			console.log("不支持websql");
		}
		

		//初始化单页view
		var viewApi = mui('#app').view({
			defaultPage: '#setting'
		});
		
		//初始化单页的区域滚动
		mui('.mui-scroll-wrapper').scroll();
		var view = viewApi.view;
		//初始化遮罩
		var mask = mui.createMask();//callback为用户点击蒙版时自动执行的回调；

		(function($) {
			//处理view的后退与webview后退
			var oldBack = $.back;
			$.back = function() {
				if (viewApi.canBack()) { //如果view可以后退，则执行view的后退
					viewApi.back();
				} else { //执行webview后退
					oldBack();
				}
			};
			
			
			//监听页面切换事件方案1,通过view元素监听所有页面切换事件，目前提供pageBeforeShow|pageShow|pageBeforeBack|pageBack四种事件(before事件为动画开始前触发)
			//第一个参数为事件名称，第二个参数为事件回调，其中e.detail.page为当前页面的html对象
			view.addEventListener('pageBeforeShow', function(e) {
				//console.log(e.detail.page.id + ' beforeShow');
				document.getElementById("accountcontent").innerHTML="";
				if(e.detail.page.id=="account"){
					
					document.getElementById("summary").style.display="none";
					//summaryhtml="";
					if(issubmit=='0'&&type=='0'){
						document.getElementById("timeshow").style.display="none";
						document.getElementsByTagName("nav")[0].style.display="";
					}else{
						document.getElementById("suwt").style.marginBottom="0px";
					}
					
					//查询本地数据库中的数据
					//websqlGetAllData("wordtest",homeworkid,studentid,classid,setSummary);
					var summaryhtml=getWordtestSummaryData(homeworkid);
					document.getElementById("accountcontent").innerHTML=summaryhtml;
				}else{
					document.getElementById("accountcontent").innerHTML="";
					
					document.getElementById("summary").style.display="";
					if(issubmit=='0'&&type=='0'){
						document.getElementById("timeshow").style.display="";
						document.getElementsByTagName("nav")[0].style.display="none";
					}
				}
			});
			view.addEventListener('pageShow', function(e) {
				console.log(e.detail.page.id + ' show');
				////作业提交的监听
				document.getElementById("submithomework").addEventListener('tap',function(){
					var url="../public/stupublish";
//					$homeworkid=I("homeworkid");
//					$paper_id=I("paper_id");
//					$starttime=I("starttime");
//					$studentid=I("studentid");
//					$schoolclass=I("classid");
//					$tms=I("tms");
            		mask.show();//显示遮罩
					mui.ajax(url,
						{
						data:{
							studentid:studentid,
							classid:classid,
							homeworkid:hwid,
							paper_id:homeworkid,
							tms:tms,
							time:c,
							starttime:starttime,
							ran:Math.random()
						},
						dataType:'json',//服务器返回json格式数据
						type:'post',//HTTP请求类型
						timeout:10000,//超时时间设置为10秒；
						async:true,
						success:function(data){
							//服务器返回然后进行h5的本地存储
							//websqlInsterDataToTable("wordtest",(ind),questionid,questionid,homeworkid,questionid,studentid,classid,"0");
							mask.close();
							mui.openWindow("finish?homeworkid={$homeworkid}&batchid={$batchid}&studentid={$studentid}&classid={$classid}&type=0");
						},
						error:function(xhr,type,errorThrown){
							//异常处理；
							mask.close();
							mui.toast("网络问题，请稍等一会儿在提交");
							return errorThrown;
						}
					});
				});
			});
			view.addEventListener('pageBeforeBack', function(e) {
				console.log(e.detail.page.id + ' beforeBack');
			});
			view.addEventListener('pageBack', function(e) {
				console.log(e.detail.page.id + ' back');
			});
			
			//试题汇总
			mui("div#accountcontent").on("tap","a.quessummary",function(){
				var index=this.getElementsByTagName("span")[0].innerHTML;
				var url=this.getAttribute("loc");
				url=url+"?homeworkid={$homeworkid}&index="+(parseInt(index)-1)+"&time="+c+"&issubmit="+issubmit+"&iserror={$iserror}&starttime={$starttime}&batchid={$batchid}&hwid={$hwid}&tms={$tms}&studentId={$studentid}&classId={$classid}&type={$type}";
				mui.openWindow(url);  
			});
			
			//作业跳转
			mui("div#topPopover").on('tap',"li.enhome",function(){
				//进行跳转
				var href=this.getAttribute("location");
				mui.openWindow(href);
			});
			
			//小红点弹出问题
			mui('body').on('shown', '.mui-popover', function(e) {
				console.log('shown', e.detail.id);//detail为当前popover元素
			});
			mui('body').on('hidden', '.mui-popover', function(e) {
				console.log('hidden', e.detail.id);//detail为当前popover元素
			});
			
			//左右滑动
			//组合部分试题子页面下一题滑动
			$("div#wordtest").on("swipeleft","div#content",function(e){
			    //表示进入下一个
			    e.preventDefault();
			    var index=parseInt(document.getElementById("quesindex").innerHTML);
			    if(index==quescount){
			    	viewApi.go("#account");
			    	return false;
			    }
			    getWordTestRespose(studentid,classid,homeworkid,index);
			});
			
			//组合部分试题子页面下一题滑动
			$("div#wordtest").on("swiperight","div#content",function(e){
				//表示返回上一个
				e.preventDefault();
				var index=parseInt(document.getElementById("quesindex").innerHTML)-2;
				if(index<0){
					mui.toast("已经到了第一题了");
					return false;
				}
			    getWordTestRespose(studentid,classid,homeworkid,index);
			});
		})(mui);
	</script>
</html>
